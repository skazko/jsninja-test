{"version":3,"sources":["src/wysiwig.ts","src/index.ts","node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["OVERLAY_ID","OldModule","module","bundle","Module","moduleName","call","hot","data","hotData","_acceptCallbacks","_disposeCallbacks","accept","fn","push","dispose","checkedAssets","assetsToAccept","parent","isParcelRequire","WebSocket","hostname","location","protocol","ws","onmessage","event","JSON","parse","type","handled","assets","forEach","asset","isNew","didAccept","hmrAcceptCheck","global","parcelRequire","id","every","generated","js","console","clear","hmrApply","v","hmrAcceptRun","reload","close","onclose","log","removeErrorOverlay","error","message","stack","overlay","createErrorOverlay","document","body","appendChild","getElementById","remove","createElement","stackTrace","innerText","innerHTML","getParents","modules","parents","k","d","dep","Array","isArray","length","concat","Function","deps","cached","cache","some","cb"],"mappings":"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","file":"src.f10117fe.js","sourceRoot":"..","sourcesContent":["interface EditorOptions {\r\n    editor?: string;\r\n    textarea?: string;\r\n    btn_h1?: string;\r\n    btn_h2?: string;\r\n    btn_bold?: string;\r\n    btn_italic?: string;\r\n}\r\n\r\nconst boldText = 'bold-text';\r\nconst italicText = 'italic-text';\r\nconst h1Text = 'header1-text';\r\nconst h2Text = 'header2-text';\r\nconst styles = [h1Text, h2Text];\r\n\r\ntype TextStyle = typeof h1Text | typeof h2Text | null;\r\ntype TextModifier = typeof boldText | typeof italicText;\r\n\r\ninterface Toolbar {\r\n    [boldText]: boolean;\r\n    [italicText]: boolean;\r\n    style: TextStyle;\r\n}\r\n\r\nexport class Editor {\r\n    public editor: HTMLElement;\r\n    public textarea: HTMLElement;\r\n    public btn_h1: HTMLElement;\r\n    public btn_h2: HTMLElement;\r\n    public btn_bold: HTMLElement;\r\n    public btn_italic: HTMLElement;\r\n    public selection: any;\r\n    public toolbar: Toolbar;\r\n    public textdelete: CustomEvent;\r\n    private _toolbar: Toolbar = {\r\n        [boldText]: false,\r\n        [italicText]: false,\r\n        style: null,\r\n    };\r\n\r\n    constructor(options: EditorOptions) {\r\n        this.editor = document.querySelector(options?.editor ?? '.editor');\r\n        this.textarea = this.editor.querySelector(options?.textarea ?? 'textarea');\r\n        this.btn_h1 = this.editor.querySelector(options?.btn_h1 ?? 'btn_h1');\r\n        this.btn_h2 = this.editor.querySelector(options?.btn_h2 ?? 'btn_h2');\r\n        this.btn_bold = this.editor.querySelector(options?.btn_bold ?? 'btn_bold');\r\n        this.btn_italic = this.editor.querySelector(options?.btn_italic ?? 'btn_italic');\r\n        this.selection = null;\r\n        this.textdelete = new CustomEvent('textdelete');\r\n        this.toolbar = new Proxy(this._toolbar, {\r\n            set: (t, p, v, r) => {\r\n                if (p === 'style') {\r\n                    if (v === h1Text) {\r\n                        this.btn_h1.classList.add('active');\r\n                        this.btn_h2.classList.remove('active');\r\n                    }\r\n                    if (v === h2Text) {\r\n                        this.btn_h2.classList.add('active');\r\n                        this.btn_h1.classList.remove('active');\r\n                    }\r\n                    if (v === null) {\r\n                        this.btn_h2.classList.remove('active');\r\n                        this.btn_h1.classList.remove('active');\r\n                    }\r\n                } else {\r\n                    const action: 'add' | 'remove' = v ? 'add' : 'remove';\r\n                    if (p === boldText) {\r\n                        this.btn_bold.classList[action]('active');\r\n                    }\r\n                    if (p === italicText) {\r\n                        this.btn_italic.classList[action]('active');\r\n                    }\r\n                }\r\n\r\n                return Reflect.set(t, p, v, r);\r\n            },\r\n        });\r\n    }\r\n\r\n    init() {\r\n        this.textarea.setAttribute('tabindex', '1');\r\n        this.textarea.setAttribute('contentEditable', 'true');\r\n        this.btn_bold.addEventListener('click', this.makeBold);\r\n        this.btn_italic.addEventListener('click', this.makeItalic);\r\n        this.btn_h1.addEventListener('click', this.applyH1);\r\n        this.btn_h2.addEventListener('click', this.applyH2);\r\n\r\n        document.addEventListener('selectionchange', this.select);\r\n        this.addPStyle();\r\n        this.textarea.addEventListener('focus', () => {\r\n            if (this.textarea.children.length === 0) {\r\n                this.addParagraph();\r\n                const span = this.textarea.lastElementChild.querySelector('span');\r\n                this.moveCaretTo(span);\r\n            }\r\n        });\r\n\r\n        this.textarea.addEventListener('textdelete', () => {\r\n            setTimeout(() => {\r\n                if (this.textarea.innerText == \"\\n\" || this.textarea.innerText === \"\") {\r\n                    this.textarea.innerHTML = '';\r\n                    this.addParagraph();\r\n                } else {\r\n                    const pars = this.textarea.querySelectorAll('.' + Array.from(this.textarea.classList).join('.') + ' .paragraph');\r\n                    pars.forEach(this.wrapText);\r\n                }\r\n            }, 0)\r\n        })\r\n\r\n        // предотвращает удаление первого параграфа и спана внутри\r\n        this.textarea.addEventListener('keydown', (e) => {\r\n            if (this.textarea.innerText === '\\u200b' || this.textarea.innerText.length === 0) {\r\n                if (e.code === 'Backspace') {\r\n                    e.preventDefault();\r\n                }\r\n            }\r\n\r\n            if (e.code === 'Backspace' || e.code === 'Delete') {\r\n                if (this.selection) {\r\n                    this.textarea.dispatchEvent(this.textdelete);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.textarea.addEventListener('keyup', (e) => {\r\n            if (e.code === 'Backspace' || e.code === 'Delete') {\r\n                const pars = this.textarea.querySelectorAll('.paragraph');\r\n                pars.forEach(p => {\r\n                    if (!p.querySelector('span')) {\r\n                        // FIXME подумать как сделать чтобы сохранять курсор \r\n                        this.textarea.dispatchEvent(new CustomEvent('emptyparagraph', {detail: {p} }));\r\n                    }\r\n                })\r\n            }\r\n            \r\n        })\r\n\r\n        this.textarea.addEventListener('emptyparagraph', (e: any) => {\r\n            e.detail.p.remove()\r\n        });\r\n\r\n        this.textarea.addEventListener('blur', () => {\r\n            if (this.textarea.innerText === '\\u200b' || this.textarea.innerText === \"\") {\r\n                this.textarea.innerHTML = '';\r\n            }\r\n        });\r\n\r\n        this.textarea.addEventListener('cut', (e) => {\r\n            this.applyStylesToParagraphs();\r\n            setTimeout(() => {\r\n                this.textarea.dispatchEvent(this.textdelete);\r\n            }, 0)\r\n            \r\n        });\r\n\r\n        this.textarea.addEventListener('paste', (e) => {\r\n            console.log(e.clipboardData.getData('text/html'))\r\n            setTimeout(() => {\r\n                const pars = this.textarea.querySelectorAll('.' + Array.from(this.textarea.classList).join('.') + ' .paragraph');\r\n                pars.forEach(this.upParagraphs);\r\n                pars.forEach(this.wrapText);\r\n            }, 50);\r\n        });\r\n\r\n        this.textarea.addEventListener('copy', (e) => {\r\n            this.applyStylesToParagraphs();\r\n        })\r\n    }\r\n\r\n    upParagraphs = (par) => {\r\n        let last = par;\r\n        par.querySelectorAll('.paragraph').forEach(p => {\r\n            console.log(p)\r\n            last.after(p);\r\n            last = p\r\n        })\r\n    }\r\n    wrapText = (par) => {\r\n        par.childNodes.forEach(n => {\r\n            if (n.nodeType === 3) {\r\n                const span = document.createElement('span');\r\n                span.innerText = n.textContent;\r\n                n.replaceWith(span);\r\n            }\r\n        })\r\n    }\r\n\r\n    addParagraph = () => {\r\n        const div = document.createElement('div');\r\n        const span = document.createElement('span');\r\n        span.innerHTML = '&#8203;';\r\n        div.appendChild(span);\r\n        div.classList.add('paragraph');\r\n        this.textarea.appendChild(div);\r\n    };\r\n\r\n    addPStyle() {\r\n        const style = document.createElement('style');\r\n        style.innerHTML = '.paragraph {font-size: 1rem;}';\r\n        document.head.append(style);\r\n    }\r\n\r\n    moveCaretTo(node: HTMLSpanElement): void {\r\n        const range = document.createRange();\r\n        range.selectNodeContents(node);\r\n        range.collapse(true);\r\n        const sel = window.getSelection();\r\n        sel.removeAllRanges();\r\n        sel.addRange(range);\r\n    }\r\n\r\n    select = () => {\r\n        const selection = document.getSelection();\r\n        // console.log(selection)\r\n        if (this.textarea.contains(selection.anchorNode)) {\r\n            if (selection.isCollapsed) {\r\n                const span = selection.anchorNode.parentElement;\r\n\r\n                if (span && span.nodeName === 'SPAN') {\r\n                    // выделение кнопок\r\n                    this.toolbar[boldText] = span.classList.contains(boldText);\r\n                    this.toolbar[italicText] = span.classList.contains(italicText);\r\n\r\n                    const p = span.closest('.paragraph');\r\n\r\n                    this.toolbar.style = p.classList.contains(h1Text)\r\n                        ? h1Text\r\n                        : p.classList.contains(h2Text)\r\n                        ? h2Text\r\n                        : null;\r\n                }\r\n                \r\n\r\n                if (this.selection) {\r\n                    this.selection = null;\r\n                }\r\n            } else {\r\n                this.selection = selection;\r\n\r\n                const container = selection.getRangeAt(0).commonAncestorContainer;\r\n\r\n                // выделение кнопок\r\n                if (container.nodeType === 3) {\r\n                    const span = container.parentElement;\r\n                    this.toolbar[boldText] = span.classList.contains(boldText);\r\n                    this.toolbar[italicText] = span.classList.contains(italicText);\r\n\r\n                    const p = span.closest('.paragraph');\r\n                    \r\n                    this.toolbar.style = p.classList.contains(h1Text)\r\n                        ? h1Text\r\n                        : p.classList.contains(h2Text)\r\n                        ? h2Text\r\n                        : null;\r\n\r\n                } else if (container.nodeName === 'SPAN') {\r\n                    this.toolbar[boldText] = (container as HTMLElement).classList.contains(boldText);\r\n                    this.toolbar[italicText] = (container as HTMLElement).classList.contains(italicText);\r\n                    \r\n                    const p = (container as HTMLElement).closest('.paragraph');\r\n\r\n                    this.toolbar.style = p.classList.contains(h1Text)\r\n                        ? h1Text\r\n                        : p.classList.contains(h2Text)\r\n                        ? h2Text\r\n                        : null;\r\n                } else {\r\n                    const fr = this.selection.getRangeAt(0).cloneContents();\r\n                    const spans = fr.querySelectorAll('span');\r\n                    const spansAr = Array.from(spans);\r\n\r\n                    this.toolbar[boldText] = spansAr.length > 0 && spansAr.every((span) =>\r\n                        (span as HTMLElement).classList.contains(boldText)\r\n                    );\r\n                    this.toolbar[italicText] = spansAr.length > 0 && spansAr.every((span) =>\r\n                        (span as HTMLElement).classList.contains(italicText)\r\n                    );\r\n\r\n                    if ((container as HTMLElement).classList.contains('paragraph')) {\r\n                        const p = container as HTMLElement;\r\n\r\n                        this.toolbar.style = p.classList.contains(h1Text)\r\n                            ? h1Text\r\n                            : p.classList.contains(h2Text)\r\n                            ? h2Text\r\n                            : null;\r\n                    } else {\r\n                        const paragraphs = new Set<HTMLElement>();\r\n                        spans.forEach(span => {\r\n                            paragraphs.add(span.closest('.paragraph'))\r\n                        });\r\n\r\n                        const ar = Array.from(paragraphs);\r\n\r\n                        this.toolbar.style = ar.every((p) => p.classList.contains(h1Text))\r\n                            ? h1Text\r\n                            : ar.every((p) => p.classList.contains(h2Text))\r\n                            ? h2Text\r\n                            : null;\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            if (this.selection) {\r\n                this.selection = null;\r\n            }\r\n        }\r\n    };\r\n\r\n    applyModifier = (mod: TextModifier) => () => {\r\n        const spans = this.processSelection();\r\n        const isAllSelectedSpansModified = spans.every((span) => span.classList.contains(mod));\r\n\r\n        if (isAllSelectedSpansModified) {\r\n            spans.forEach((span) => span.classList.toggle(mod));\r\n            this.toolbar[mod] = !this.toolbar[mod];\r\n        } else {\r\n            spans.forEach((span) => span.classList.add(mod));\r\n            this.toolbar[mod] = true;\r\n        }\r\n    };\r\n\r\n    makeBold = this.applyModifier(boldText);\r\n    makeItalic = this.applyModifier(italicText);\r\n\r\n    applyStyle = (style: TextStyle) => () => {\r\n        const spans = this.processSelection();\r\n\r\n        if (spans[0] !== spans[0].closest('.paragraph').firstElementChild) {\r\n            const parToSplit = spans[0].closest('.paragraph') as HTMLDivElement;\r\n            parToSplit.after(splitParagraph(parToSplit, spans));\r\n        }\r\n\r\n        if (spans[spans.length - 1] !== spans[spans.length - 1].closest('.paragraph').lastElementChild) {\r\n            const parToSplit = spans[spans.length - 1].closest('.paragraph') as HTMLDivElement;\r\n            parToSplit.before(splitParagraph(parToSplit, spans));\r\n        }\r\n\r\n\r\n        const paragraphs = new Set<HTMLElement>();\r\n        spans.forEach(span => {\r\n            paragraphs.add(span.closest('.paragraph'))\r\n        });\r\n\r\n        const ar = Array.from(paragraphs);\r\n\r\n        const isStyled = ar.every((p) => p.classList.contains(style));\r\n        const filteredStyles = styles.filter((s) => s !== style);\r\n\r\n        if (isStyled) {\r\n            ar.forEach((p) => p.classList.toggle(style));\r\n            this.toolbar.style = null;\r\n        } else {\r\n            ar.forEach((p) => {\r\n                filteredStyles.forEach((fStyle) => p.classList.remove(fStyle));\r\n                p.classList.add(style);\r\n                this.toolbar.style = style;\r\n            });\r\n        }\r\n    };\r\n\r\n    applyH1 = this.applyStyle(h1Text);\r\n    applyH2 = this.applyStyle(h2Text);\r\n\r\n    processSelection(): HTMLElement[] {\r\n        const selection = this.selection;\r\n        const range: Range = selection.getRangeAt(0);\r\n        const output: HTMLElement[] = [];\r\n\r\n        if (range.startContainer === range.endContainer) {\r\n            // выделение внутри одного узла\r\n            if (range.startContainer.nodeType === 3) {\r\n                // выделили текстовый узел\r\n                if (range.startOffset === 0 && range.endOffset === (range.endContainer as Text).length) {\r\n                    // выделен весь узел полностью\r\n                    // все текстовые узлы должны быть в спанах\r\n                    let span = range.startContainer.parentElement;\r\n                    output.push(span);\r\n                } else {\r\n                    // узел выделен не полностью разбить на спаны\r\n                    const span = range.startContainer.parentElement;\r\n                    const mSpan = splitSpan(span, range.startOffset, range.endOffset);\r\n                    output.push(mSpan);\r\n                }\r\n            } else {\r\n                // выделен либо span либо параграф\r\n                if (range.startContainer.nodeName === 'SPAN') {\r\n                    output.push(range.startContainer as HTMLElement);\r\n                } else if ((range.startContainer as HTMLElement).classList.contains('paragraph')) {\r\n                    for (let i = range.startOffset; i < range.endOffset; i++) {\r\n                        output.push((range.startContainer as HTMLElement).children.item(i) as HTMLElement);\r\n                    }\r\n                }\r\n\r\n                // TODO: добавить проверку на див\r\n            }\r\n        } else {\r\n            // выделение в разных узлах\r\n            const wrap = range.commonAncestorContainer as HTMLElement;\r\n            // wrap должен быть либо .paragraph либо textarea;\r\n            // FIXME hardcode\r\n            if (wrap.classList.contains('paragraph')) {\r\n                output.push(...getSpans(wrap, range));\r\n            }\r\n\r\n            // FIXME hardcode\r\n            if (wrap.classList.contains('edit-area')) {\r\n                // внутри textarea должны быть только параграфы\r\n                let firstP: HTMLElement;\r\n                let lastP: HTMLElement;\r\n\r\n                if (range.startContainer.nodeType === 3) {\r\n                    const el = range.startContainer.parentElement;\r\n                    if (el.classList.contains('paragraph')) {\r\n                        firstP = el;\r\n                    } else {\r\n                        firstP = el.closest('.paragraph');\r\n                    }\r\n                } else {\r\n                    if ((range.startContainer as HTMLElement).classList.contains('paragraph')) {\r\n                        firstP = range.startContainer as HTMLElement;\r\n                    } else {\r\n                        firstP = (range.startContainer as HTMLElement).closest('.paragraph');\r\n                    }\r\n                }\r\n\r\n                if (range.endContainer.nodeType === 3) {\r\n                    const el = range.endContainer.parentElement;\r\n                    if (el.classList.contains('paragraph')) {\r\n                        lastP = el;\r\n                    } else {\r\n                        lastP = el.closest('.paragraph');\r\n                    }\r\n                } else {\r\n                    if ((range.endContainer as HTMLElement).classList.contains('paragraph')) {\r\n                        lastP = range.endContainer as HTMLElement;\r\n                    } else {\r\n                        lastP = (range.endContainer as HTMLElement).closest('.paragraph');\r\n                    }\r\n                }\r\n\r\n                let next = firstP;\r\n\r\n                while (next && next !== lastP) {\r\n                    output.push(...getSpans(next, range));\r\n                    next = next.nextElementSibling as HTMLElement;\r\n                }\r\n\r\n                output.push(...getSpans(lastP, range));\r\n            }\r\n        }\r\n\r\n        const newRange = new Range();\r\n        newRange.setStartBefore(output[0]);\r\n        newRange.setEndAfter(output[output.length - 1]);\r\n\r\n        const sel = document.getSelection();\r\n        sel.removeAllRanges();\r\n        sel.addRange(newRange);\r\n\r\n        return output;\r\n    }\r\n\r\n    applyStylesToParagraphs() {\r\n        document.querySelectorAll('.paragraph').forEach(p => {\r\n            const computedProps = getComputedStyle(p);\r\n\r\n            getAppliedStyleProps(p as HTMLElement).forEach(prop => {\r\n                (p as HTMLElement).style[prop] = computedProps[prop];\r\n            });\r\n            \r\n        })\r\n    }\r\n}\r\n\r\nfunction splitSpan(span: HTMLElement, startOffset: number, endOffset: number): HTMLElement {\r\n    let fSpan: Node;\r\n    let mSpan: HTMLElement = span.cloneNode(true) as HTMLElement; // выделенный спан\r\n    let lSpan: Node;\r\n\r\n    // выделение не сначала\r\n    if (startOffset !== 0) {\r\n        fSpan = span.cloneNode(true);\r\n        (fSpan.firstChild as Text).splitText(startOffset);\r\n        fSpan.lastChild.remove();\r\n\r\n        (mSpan.firstChild as Text).splitText(startOffset);\r\n        mSpan.firstChild.remove();\r\n    }\r\n\r\n    // выделение не до конца\r\n    if (endOffset !== (span.firstChild as Text).length) {\r\n        (mSpan.firstChild as Text).splitText(endOffset - startOffset);\r\n        mSpan.lastChild.remove();\r\n\r\n        lSpan = span.cloneNode(true);\r\n        (lSpan.firstChild as Text).splitText(endOffset);\r\n        lSpan.firstChild.remove();\r\n    }\r\n\r\n    const spans = [fSpan, mSpan, lSpan].filter((span) => {\r\n        return typeof span !== 'undefined' && span.textContent !== \"\\n\" && span.textContent !== \"\\u200b\"\r\n    });\r\n    span.replaceWith(...spans);\r\n\r\n    return mSpan;\r\n}\r\n\r\nfunction getSpans(wrap: HTMLElement, range: Range): HTMLElement[] {\r\n    const output: HTMLElement[] = [];\r\n    const startContainer = range.startContainer;\r\n    const endContainer = range.endContainer;\r\n    let startSpan: HTMLElement;\r\n    let endSpan: HTMLElement;\r\n\r\n    if (wrap.contains(startContainer)) {\r\n        if (startContainer.nodeType === 3) {\r\n            startSpan = splitSpan(startContainer.parentElement, range.startOffset, (startContainer as Text).length);\r\n        } else {\r\n            if (startContainer.nodeName === 'SPAN') {\r\n                startSpan = startContainer as HTMLElement;\r\n            } else {\r\n                startSpan = (startContainer as HTMLElement).querySelector('span');\r\n            }\r\n            // другие варианты?\r\n        }\r\n        output.push(startSpan);\r\n    }\r\n\r\n    if (wrap.contains(endContainer)) {\r\n        if (endContainer.nodeType === 3) {\r\n            endSpan = splitSpan(endContainer.parentElement, 0, range.endOffset);\r\n        } else {\r\n            if (endContainer.nodeName === 'SPAN') {\r\n                endSpan = endContainer as HTMLElement;\r\n            } else {\r\n                endSpan = (endContainer as HTMLElement).querySelector('span:last-child');\r\n            }\r\n            // другие варианты?\r\n        }\r\n    }\r\n\r\n    let next = (startSpan ? startSpan.nextElementSibling : wrap.firstElementChild) as HTMLElement;\r\n\r\n    while (next && next !== endSpan) {\r\n        output.push(next);\r\n        next = next.nextElementSibling as HTMLElement;\r\n    }\r\n\r\n    if (endSpan) {\r\n        output.push(endSpan);\r\n    }\r\n\r\n    return output;\r\n}\r\n\r\nfunction getAppliedStyleProps(el: HTMLElement): Array<string> {\r\n    const appliedRules = new Set<string>();\r\n    for (let i = 0; i < document.styleSheets.length; i++) {\r\n        const rules = document.styleSheets[i].cssRules;\r\n        for (let j = 0; j < rules.length; j++) {\r\n            const rule = rules[j] as CSSStyleRule;\r\n            if (el.matches(rule.selectorText)) {\r\n                for (let k = 0; k < rule.style.length; k++) {\r\n                    const styleProp = rule.style[k];\r\n                    appliedRules.add(styleProp);\r\n                }\r\n                \r\n            }\r\n        }\r\n    }\r\n    return Array.from(appliedRules);\r\n}\r\n\r\nfunction splitParagraph(par: HTMLElement, spans: HTMLElement[]): HTMLDivElement {\r\n    const newPar = document.createElement('div');\r\n    newPar.classList.add('paragraph');\r\n\r\n    let next = par.firstChild;\r\n    while (next) {\r\n        if (spans.includes(next as HTMLElement)) {\r\n            newPar.append(next);\r\n            next = par.firstChild;\r\n        } else {\r\n            next = next.nextSibling;\r\n        }\r\n    }\r\n\r\n    return newPar;\r\n}","import {Editor} from './wysiwig';\r\n\r\nconst editor = new Editor({\r\n    editor: '.editor',\r\n    textarea: '.edit-area',\r\n    btn_h1: '.head-1',\r\n    btn_h2: '.head-2',\r\n    btn_bold: '.bold',\r\n    btn_italic: '.italic',\r\n});\r\n\r\neditor.init();\r\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else if (location.reload) { // `location` global exists in a web worker context but lacks `.reload()` function.\n        location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel] ✨ Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel] 🚨  ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\">🚨</span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}